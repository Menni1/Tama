<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Liquid Glass Tamagotchi ‚Äî Onefile</title>
<style>
/* ===============
   Liquid Glass Design (iOS-like)
   =============== */
:root{
  --bg1: #0b0d12;
  --bg2: #0f1320;
  --fg: #e9ecf1;
  --muted:#a9b1c7;
  --accent:#87b4ff;
  --accent-2:#7cf1cf;
  --good:#36d399;
  --warn:#ffd166;
  --bad:#ff6b6b;
  --glass: rgba(255,255,255,.08);
  --glass-strong: rgba(255,255,255,.14);
  --stroke: rgba(255,255,255,.22);
  --shadow: 0 20px 60px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.06);
  --ring-bg: rgba(255,255,255,.08);
}
@media (prefers-color-scheme: light){
  :root{
    --bg1:#eff3ff; --bg2:#e3e9fb; --fg:#0e1320; --muted:#52607a;
    --accent:#2563eb; --accent-2:#00c2a8;
    --glass: rgba(255,255,255,.6); --glass-strong: rgba(255,255,255,.75);
    --stroke: rgba(0,0,0,.08); --shadow: 0 20px 50px rgba(0,0,0,.12), inset 0 1px 0 rgba(255,255,255,.8);
    --ring-bg: rgba(0,0,0,.08);
  }
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "SF Pro", Segoe UI, Roboto;
  color:var(--fg);
  background:
     radial-gradient(1200px 800px at -10% -10%, #3a66ff20, transparent 60%),
     radial-gradient(1000px 700px at 110% 120%, #00ffc820, transparent 60%),
     linear-gradient(180deg, var(--bg1), var(--bg2));
  -webkit-font-smoothing: antialiased;
  -webkit-tap-highlight-color: transparent;
}

/* Liquid blobs behind */
.blobs{position:fixed; inset:-10% -10% -10% -10%; z-index:-1; filter: blur(40px) saturate(130%); pointer-events:none}
.blob{position:absolute; width:38vmax; height:38vmax; border-radius:50%; opacity:.7; mix-blend-mode: screen}
.blob.b1{left:-8vmax; top:-6vmax; background: radial-gradient(circle at 30% 30%, #6ea8ff, #3a66ff 60%, transparent 70%)}
.blob.b2{right:-10vmax; top:10vmax; background: radial-gradient(circle at 50% 50%, #46ffd7, #00c2a8 60%, transparent 70%)}
.blob.b3{left:20vmax; bottom:-12vmax; background: radial-gradient(circle at 50% 50%, #ffd166, #ff9f43 60%, transparent 70%)}
@media (max-width:560px){ .blob{width:60vmax; height:60vmax} }

/* Safe area padding for iPhone */
.app{
  max-width: 900px;
  margin: 0 auto;
  padding: calc(16px + env(safe-area-inset-top)) 16px calc(96px + env(safe-area-inset-bottom));
}

/* Glass header */
header{
  position: sticky; top: 0; z-index: 10;
  margin: -16px -16px 16px;
  padding: 14px 16px calc(14px + env(safe-area-inset-top));
  backdrop-filter: blur(18px) saturate(140%);
  -webkit-backdrop-filter: blur(18px) saturate(140%);
  background: linear-gradient(180deg, var(--glass-strong), transparent);
  border-bottom: 1px solid var(--stroke);
}
h1{margin:0; font-size:20px; letter-spacing:.2px; font-weight:700}
.sub{color:var(--muted); font-size:12px}

/* Glass card */
.card{
  background: linear-gradient(180deg, var(--glass), transparent 140%);
  border: 1px solid var(--stroke);
  border-radius: 20px;
  box-shadow: var(--shadow);
  padding: 14px;
  margin: 12px 0;
  backdrop-filter: blur(18px) saturate(140%);
  -webkit-backdrop-filter: blur(18px) saturate(140%);
}

/* Layout helpers */
.grid{display:grid; gap:12px}
.cols-2{grid-template-columns: repeat(2, minmax(0, 1fr))}
.cols-3{grid-template-columns: repeat(3, minmax(0, 1fr))}
.flex{display:flex; gap:12px; align-items:center; flex-wrap:wrap}
.center{display:flex; align-items:center; justify-content:center}
.row{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.grow{flex:1}
.tiny{font-size:11px} .muted{color:var(--muted)}
.mono{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace}

/* Pet "orb" */
.orb{
  width: 260px; aspect-ratio: 1/1; border-radius: 30px; position: relative; overflow: hidden;
  background:
    radial-gradient(160px 120px at 30% 20%, rgba(255,255,255,.35), transparent 50%),
    radial-gradient(100px 120px at 80% 10%, rgba(255,255,255,.2), transparent 60%),
    linear-gradient(180deg, #16203a, #0f1628);
  border: 1px solid var(--stroke);
  box-shadow: var(--shadow);
}
.orb::before{
  content:""; position:absolute; inset:0;
  background:
     radial-gradient(1000px 500px at 50% -10%, #8fbaff33, transparent 60%),
     radial-gradient(800px 600px at 120% 120%, #00ffd533, transparent 60%);
  mix-blend-mode: screen; pointer-events:none;
}
.scene{position:absolute; inset:0}
.ground{position:absolute; inset:auto 0 0 0; height:42%;
  background: linear-gradient(180deg, #1c2847, #152038);
  border-top: 1px solid rgba(255,255,255,.15);
}
.face{position:absolute; left:50%; top:46%; transform: translate(-50%, -50%); text-align:center}
.emoji{font-size:70px; line-height:70px; filter: drop-shadow(0 10px 14px rgba(0,0,0,.35))}
.name{margin-top:4px; font-weight:700}

/* Glass ring stats */
.stat{
  height:120px; width:120px; border-radius: 24px; position: relative;
  background: linear-gradient(180deg, var(--glass), transparent 140%);
  border:1px solid var(--stroke);
  box-shadow: var(--shadow);
  display:flex; align-items:center; justify-content:center; flex-direction:column;
  overflow:hidden;
}
.ring{
  --p: 180deg;
  position:absolute; inset:0;
  background:
    radial-gradient(circle at 50% 50%, rgba(0,0,0,.18) 53px, transparent 54px),
    conic-gradient(var(--accent) 0deg, var(--accent) var(--p), var(--ring-bg) var(--p), var(--ring-bg) 360deg);
  mask: radial-gradient(circle at 50% 50%, transparent 52px, black 54px);
  -webkit-mask: radial-gradient(circle at 50% 50%, transparent 52px, black 54px);
  opacity:.95;
}
.stat b{font-size:20px; z-index:1}
.stat small{z-index:1; color:var(--muted)}

/* Buttons */
.btn, .action{
  border: 1px solid var(--stroke);
  background: linear-gradient(180deg, var(--glass-strong), transparent 120%);
  color: var(--fg); font-weight:700;
  border-radius: 14px; padding: 12px 14px; cursor:pointer;
  box-shadow: var(--shadow);
  width:100%;
}
.btn:active, .action:active{transform: translateY(1px) scale(.998)}

/* Toolbar (bottom) */
.toolbar{
  position: fixed; left:0; right:0; bottom:0;
  padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
  backdrop-filter: blur(16px) saturate(140%);
  -webkit-backdrop-filter: blur(16px) saturate(140%);
  background: linear-gradient(180deg, transparent, var(--glass-strong));
  border-top: 1px solid var(--stroke);
}
.toolbar .bar{
  max-width:900px; margin:0 auto;
  display:grid; gap:12px; grid-template-columns: repeat(4, minmax(0,1fr));
}

/* Inputs */
input[type="text"]{
  width:100%; padding:12px; border-radius:14px; border:1px solid var(--stroke);
  background: linear-gradient(180deg, var(--glass), transparent 160%);
  color: var(--fg);
}

/* Badges */
.badge{font-size:10px; padding:4px 8px; border-radius:999px; background: linear-gradient(180deg, var(--glass-strong), transparent 120%); border:1px solid var(--stroke)}

/* Responsive */
@media (max-width:860px){
  .cols-3{grid-template-columns:1fr 1fr}
}
@media (max-width:640px){
  .cols-2{grid-template-columns:1fr}
  .cols-3{grid-template-columns:1fr}
  .orb{width: 100%}
}
</style>
</head>
<body>
<div class="blobs">
  <div class="blob b1"></div>
  <div class="blob b2"></div>
  <div class="blob b3"></div>
</div>

<div class="app">
  <header>
    <h1>Liquid Glass Tamagotchi <span class="badge">Onefile</span></h1>
    <div class="sub">iPhone‚Äëoptimiert ‚Ä¢ Offline ‚Ä¢ Weitergeben ohne Server</div>
  </header>

  <div class="card flex">
    <div class="orb center grow">
      <div class="scene">
        <div class="ground"></div>
        <div class="face">
          <div id="emoji" class="emoji">üòÄ</div>
          <div id="petName" class="name">Mein Haustier</div>
          <div class="row muted tiny" style="justify-content:center; margin-top:6px">
            <span id="ageLabel">0 Tage alt</span> ‚Ä¢ <span id="moodLabel">Laune: ok</span>
          </div>
        </div>
      </div>
    </div>

    <div class="grid cols-3 grow">
      <div class="stat center grid">
        <div id="ring-hunger" class="ring" style="--p: 120deg"></div>
        <b id="val-hunger">0%</b><small>S√§ttigung</small>
        <button class="btn" data-act="feed">üçé F√ºttern</button>
      </div>
      <div class="stat center grid">
        <div id="ring-energy" class="ring" style="--p: 220deg"></div>
        <b id="val-energy">0%</b><small>Energie</small>
        <button class="btn" data-act="sleep">üò¥ Schlafen</button>
      </div>
      <div class="stat center grid">
        <div id="ring-hygiene" class="ring" style="--p: 180deg"></div>
        <b id="val-hygiene">0%</b><small>Hygiene</small>
        <button class="btn" data-act="wash">ü´ß Waschen</button>
      </div>
    </div>
  </div>

  <div class="card grid cols-2">
    <div class="grid">
      <label class="tiny muted">Name</label>
      <input id="newName" type="text" placeholder="Name eingeben‚Ä¶" maxlength="24">
      <button class="btn" id="renameBtn">Umbenennen</button>
    </div>
    <div class="grid">
      <div class="row muted tiny"><span>üéÆ</span><b style="margin-left:6px">Spielen</b><span style="margin-left:6px">(+Laune, ‚àíEnergie)</span></div>
      <button class="btn" data-act="play">Jetzt spielen</button>
      <div id="tip" class="tiny muted">Tipp: Regelm√§√üig √∂ffnen h√§lt dein Haustier gl√ºcklich.</div>
    </div>
  </div>

  <div class="card grid">
    <b>Weitergeben</b>
    <div class="muted tiny">Exportiere den Zustand als Code und schicke ihn z.‚ÄØB. per Messenger. Freund:innen k√∂nnen ihn importieren und weiterpflegen.</div>
    <div class="grid cols-2">
      <div class="grid">
        <button class="btn" id="exportBtn">Zustand exportieren</button>
        <div id="exportOut" class="mono tiny" style="word-break:break-all"></div>
        <button class="btn" id="copyBtn">Code kopieren</button>
      </div>
      <div class="grid">
        <input id="importIn" type="text" placeholder="Code hier einf√ºgen‚Ä¶">
        <button class="btn" id="importBtn">Importieren</button>
      </div>
    </div>
    <div class="tiny muted">Sicherheit: Der Code enth√§lt nur den Haustier‚ÄëStatus (ohne pers√∂nliche Daten) und eine Pr√ºfsumme. Alles passiert lokal im Browser.</div>
  </div>

  <div class="card grid">
    <b>Protokoll</b>
    <div id="log" class="tiny mono" style="white-space:pre-wrap; max-height:180px; overflow:auto"></div>
    <div class="row">
      <button class="btn" id="clearLog">Protokoll leeren</button>
      <button class="btn" id="resetBtn">Zur√ºcksetzen</button>
    </div>
  </div>
</div>

<div class="toolbar">
  <div class="bar">
    <div class="row" style="gap:12px">
      <button class="action" data-act="feed">üçé F√ºttern</button>
      <button class="action" data-act="play">üé≤ Spielen</button>
      <button class="action" data-act="wash">ü´ß Waschen</button>
      <button class="action" data-act="sleep">üò¥ Schlafen</button>
    </div>
  </div>
</div>

<script>
/* ===============
   Tamagotchi Logic (offline, single-file)
   =============== */
(function(){
  const $ = s => document.querySelector(s);
  const logEl = $("#log");
  const KEY = "tamaState_liquid_v1";
  const clamp = (v, min, max) => Math.max(min, Math.min(max, v));

  function checksum(str){
    let h = 0; for (let i=0;i<str.length;i++){ h = (h*131 + str.charCodeAt(i)) >>> 0; }
    return h.toString(36);
  }

  function load(){
    const raw = localStorage.getItem(KEY);
    if(!raw){
      const now = Date.now();
      return { name:"Mein Haustier", birthday: now, lastSeen: now, alive:true,
               hunger: 28, energy: 72, hygiene: 70, happiness: 72,
               ageDays: 0, stage:1, log:[] };
    }
    try{ return JSON.parse(raw); }catch(e){ localStorage.removeItem(KEY); return load(); }
  }
  function save(s){ localStorage.setItem(KEY, JSON.stringify(s)); }
  let S = load();

  // Time decay
  function applyDecay(){
    const now = Date.now();
    const hours = Math.max(0, (now - S.lastSeen)/36e5);
    if (hours < 0.01) return;
    const hungerUp = 6, energyDown = 5, hygieneDown = 3, moodDrift = 2;
    S.hunger = clamp(S.hunger + hungerUp*hours, 0, 100);
    S.energy = clamp(S.energy - energyDown*hours, 0, 100);
    S.hygiene = clamp(S.hygiene - hygieneDown*hours, 0, 100);
    const penalty = (S.hunger*0.35) + ((100 - S.energy)*0.25) + ((100 - S.hygiene)*0.20) + hours*moodDrift;
    S.happiness = clamp(100 - penalty, 0, 100);
    const ageDays = Math.floor((now - S.birthday)/86400000);
    if (ageDays !== S.ageDays){
      S.ageDays = ageDays;
      pushLog(`üéÇ Tag ${S.ageDays}: wieder ein St√ºck gewachsen.`);
      if (S.ageDays === 3) S.stage = 2;
      if (S.ageDays === 7) S.stage = 3;
    }
    if (S.hunger >= 100 && hours > 6){
      S.alive = false;
      pushLog("üí® Dein Haustier ist auf Reisen gegangen (Vernachl√§ssigung). Innerhalb 24h in einem Freundes‚ÄëBrowser importieren, um es zur√ºckzuholen.");
    }
    S.lastSeen = now; save(S);
  }

  function faceByMood(){
    if(!S.alive) return "ü•∫";
    if (S.happiness > 80) return "ü§©";
    if (S.happiness > 60) return "üòÄ";
    if (S.happiness > 40) return "üôÇ";
    if (S.happiness > 20) return "üòï";
    return "üò¢";
  }
  function moodLabel(){
    const v = Math.round(S.happiness);
    if(!S.alive) return "unterwegs‚Ä¶";
    if (v>80) return "gl√ºcklich";
    if (v>60) return "gut";
    if (v>40) return "ok";
    if (v>20) return "m√ºde";
    return "traurig";
  }

  function setRing(id, value){
    const deg = Math.round(clamp(value,0,100)/100 * 360);
    const el = $("#ring-"+id);
    el.style.setProperty("--p", deg+"deg");
    $("#val-"+id).textContent = Math.round(value) + "%";
  }

  function render(){
    $("#petName").textContent = S.name || "Mein Haustier";
    $("#emoji").textContent = faceByMood();
    $("#ageLabel").textContent = `${S.ageDays} Tage alt`;
    $("#moodLabel").textContent = `Laune: ${moodLabel()}`;
    setRing("hunger", 100 - S.hunger); // S√§ttigung = invertierter Hunger
    setRing("energy", S.energy);
    setRing("hygiene", S.hygiene);
  }

  function pushLog(msg){
    const t = new Date().toLocaleString();
    S.log.unshift(`[${t}] ${msg}`);
    S.log = S.log.slice(0,200);
    logEl.textContent = S.log.join("\\n");
    save(S);
  }

  // Actions with cooldowns
  const cooldowns = { feed: 5*60*1000, play: 5*60*1000, wash: 10*60*1000, sleep: 10*60*1000 };
  const lastAction = { feed:0, play:0, wash:0, sleep:0 };
  const canAct = k => (Date.now() - lastAction[k]) >= cooldowns[k];
  const markAct = k => (lastAction[k] = Date.now());

  const actions = {
    feed(){
      if(!S.alive) return alert("Es ist unterwegs‚Ä¶ importiere den Code in einem Freundes‚ÄëBrowser, um es zur√ºckzuholen.");
      if(!canAct("feed")) return alert("Noch satt. Versuch es sp√§ter.");
      const before = S.hunger;
      S.hunger = clamp(S.hunger - 35, 0, 100);
      S.happiness = clamp(S.happiness + 8, 0, 100);
      markAct("feed"); pushLog(`üçé Gef√ºttert (${Math.round(before)} ‚Üí ${Math.round(S.hunger)} Hunger).`);
    },
    play(){
      if(!S.alive) return alert("Es ist unterwegs‚Ä¶");
      if(!canAct("play")) return alert("Noch am Spielen!");
      S.happiness = clamp(S.happiness + 18, 0, 100);
      S.energy = clamp(S.energy - 12, 0, 100);
      S.hygiene = clamp(S.hygiene - 6, 0, 100);
      markAct("play"); pushLog("üé≤ Gemeinsam gespielt (+Laune, ‚àíEnergie, ‚àíHygiene).");
    },
    wash(){
      if(!S.alive) return alert("Es ist unterwegs‚Ä¶");
      if(!canAct("wash")) return alert("Schon sauber genug.");
      S.hygiene = clamp(S.hygiene + 28, 0, 100);
      S.happiness = clamp(S.happiness + 4, 0, 100);
      markAct("wash"); pushLog("ü´ß Gewaschen (+Hygiene).");
    },
    sleep(){
      if(!S.alive) return alert("Es ist unterwegs‚Ä¶");
      if(!canAct("sleep")) return alert("Noch wach. Warte etwas.");
      const rest = 20 + Math.random()*15;
      S.energy = clamp(S.energy + rest, 0, 100);
      S.hunger = clamp(S.hunger + 6, 0, 100);
      S.happiness = clamp(S.happiness + 6, 0, 100);
      markAct("sleep"); pushLog("üò¥ Ein Nickerchen gemacht (+Energie, +Laune, +Hunger).");
    }
  };

  // Export / Import
  function exportCode(){
    const payload = JSON.stringify({
      name:S.name, birthday:S.birthday, lastSeen:Date.now(), alive:S.alive,
      hunger:S.hunger, energy:S.energy, hygiene:S.hygiene, happiness:S.happiness,
      ageDays:S.ageDays, stage:S.stage
    });
    const sig = checksum(payload);
    return btoa(unescape(encodeURIComponent(JSON.stringify({p:payload, s:sig}))));
  }
  function importCode(code){
    try{
      const obj = JSON.parse(decodeURIComponent(escape(atob(code))));
      if (checksum(obj.p) !== obj.s) throw new Error("bad checksum");
      const data = JSON.parse(obj.p);
      const within = Date.now() - (data.lastSeen||Date.now());
      if (data.alive === false && within <= 86400000){ data.alive = true; pushLog("üß≠ Zur√ºck von der Reise!"); }
      S = Object.assign(S, data, { lastSeen: Date.now() });
      save(S); render(); pushLog("üì• Zustand importiert."); return true;
    }catch(e){ alert("Ung√ºltiger Code."); return false; }
  }

  // Wire events
  document.querySelectorAll("[data-act]").forEach(btn => {
    const kind = btn.getAttribute("data-act");
    const handler = () => { actions[kind](); save(S); render(); };
    btn.addEventListener("click", handler, {passive:true});
    btn.addEventListener("touchstart", handler, {passive:true});
  });
  $("#renameBtn").addEventListener("click", ()=>{
    const v = $("#newName").value.trim();
    if (v){ S.name=v; save(S); render(); pushLog(`‚úèÔ∏è Umbenannt in ‚Äû${v}‚Äú.`); }
  }, {passive:true});
  $("#exportBtn").addEventListener("click", ()=>{ $("#exportOut").textContent = exportCode(); }, {passive:true});
  $("#copyBtn").addEventListener("click", async ()=>{
    const t = $("#exportOut").textContent.trim(); if(!t) return;
    try{ await navigator.clipboard.writeText(t); alert("Code kopiert!"); }catch{ alert("Kopieren nicht m√∂glich. Markiere den Code manuell."); }
  }, {passive:true});
  $("#importBtn").addEventListener("click", ()=>{
    const code = $("#importIn").value.trim(); if(code) importCode(code);
  }, {passive:true});
  $("#clearLog").addEventListener("click", ()=>{ S.log=[]; save(S); logEl.textContent=""; }, {passive:true});
  $("#resetBtn").addEventListener("click", ()=>{
    if(confirm("Wirklich alles zur√ºcksetzen?")){
      localStorage.removeItem(KEY); S = load(); save(S); render(); pushLog("üîÑ Zur√ºckgesetzt.");
    }
  }, {passive:true});

  // Start
  applyDecay(); render(); logEl.textContent = (S.log||[]).join("\\n");
})();
</script>
</body>
</html>
